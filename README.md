<div align="center">
<h1><img width="30" src="https://madewithml.com/static/images/rounded_logo.png">&nbsp;<a href="https://madewithml.com/">Made With ML</a></h1>
Applied ML ¬∑ MLOps ¬∑ Production
<br>
Join 30K+ developers in learning how to responsibly <a href="https://madewithml.com/about/">deliver value</a> with ML.
    <br>
</div>

<br>

<div align="center">
    <a target="_blank" href="https://newsletter.madewithml.com"><img src="https://img.shields.io/badge/Subscribe-30K-brightgreen"></a>&nbsp;
    <a target="_blank" href="https://github.com/GokuMohandas/MadeWithML"><img src="https://img.shields.io/github/stars/GokuMohandas/MadeWithML.svg?style=social&label=Star"></a>&nbsp;
    <a target="_blank" href="https://www.linkedin.com/in/goku"><img src="https://img.shields.io/badge/style--5eba00.svg?label=LinkedIn&logo=linkedin&style=social"></a>&nbsp;
    <a target="_blank" href="https://twitter.com/GokuMohandas"><img src="https://img.shields.io/twitter/follow/GokuMohandas.svg?label=Follow&style=social"></a>
    <br>
    üî•&nbsp; Among the <a href="https://github.com/topics/mlops" target="_blank">top MLOps</a> repositories on GitHub
</div>

<br>
<hr>

## MLOps
Learn how to apply ML to build a production grade product to deliver value.

- Lessons: https://madewithml.com/courses/mlops/
- Code: [GokuMohandas/MLOps](https://github.com/GokuMohandas/MLOps)

> If you need refresh yourself on the foundations of machine learning, check out our [Made With ML](https://github.com/GokuMohandas/MadeWithML) repository.

<table>
    <tr>
        <td align="center"><b>üì¶&nbsp; Product</b></td>
        <td align="center"><b>üìù&nbsp; Scripting</b></td>
        <td align="center"><b>‚ôªÔ∏è&nbsp; Reproducibility</b></td>
    </tr>
    <tr>
        <td><a href="https://madewithml.com/courses/mlops/objective/">Objective</a></td>
        <td><a href="https://madewithml.com/courses/mlops/organization/">Organization</a></td>
        <td><a href="https://madewithml.com/courses/mlops/git/">Git</a></td>
    </tr>
    <tr>
        <td><a href="https://madewithml.com/courses/mlops/solution/">Solution</a></td>
        <td><a href="https://madewithml.com/courses/mlops/packaging/">Packaging</a></td>
        <td><a href="https://madewithml.com/courses/mlops/pre-commit/">Pre-commit</a></td>
    </tr>
    <tr>
        <td><a href="https://madewithml.com/courses/mlops/iteration/">Iteration</a></td>
        <td><a href="https://madewithml.com/courses/mlops/documentation/">Documentation</a></td>
        <td><a href="https://madewithml.com/courses/mlops/versioning/">Versioning</a></td>
    </tr>
    <tr>
        <td align="center"><b>üî¢&nbsp; Data</b></td>
        <td><a href="https://madewithml.com/courses/mlops/styling/">Styling</a></td>
        <td><a href="https://madewithml.com/courses/mlops/docker/">Docker</a></td>
    </tr>
    <tr>
        <td><a href="https://madewithml.com/courses/mlops/labeling/">Labeling</a></td>
        <td><a href="https://madewithml.com/courses/mlops/makefile/">Makefile</a></td>
        <td align="center"><b>üöÄ&nbsp; Production</b></td>
    </tr>
    <tr>
        <td><a href="https://madewithml.com/courses/mlops/preprocessing/">Preprocessing</a></td>
        <td><a href="https://madewithml.com/courses/mlops/logging/">Logging</a></td>
        <td><a href="https://madewithml.com/courses/mlops/dashboard/">Dashboard</a></td>
    </tr>
    <tr>
        <td><a href="https://madewithml.com/courses/mlops/exploratory-data-analysis/">Exploratory data analysis</a></td>
        <td align="center"><b>üì¶&nbsp; Interfaces</b></td>
        <td><a href="https://madewithml.com/courses/mlops/cicd/">CI/CD workflows</a></td>
    </tr>
    <tr>
        <td><a href="https://madewithml.com/courses/mlops/splitting/">Splitting</a></td>
        <td><a href="https://madewithml.com/courses/mlops/cli/">Command-line</a></td>
        <td><a href="https://madewithml.com/courses/mlops/infrastructure/">Infrastructure</a></td>
    </tr>
    <tr>
        <td><a href="https://madewithml.com/courses/mlops/augmentation/">Augmentation</a></td>
        <td><a href="https://madewithml.com/courses/mlops/api/">RESTful API</a></td>
        <td><a href="https://madewithml.com/courses/mlops/monitoring/">Monitoring</a></td>
    </tr>
    <tr>
        <td align="center"><b>üìà&nbsp; Modeling</b></td>
        <td align="center"><b>‚úÖ&nbsp; Testing</b></td>
        <td><a href="https://madewithml.com/courses/mlops/feature-store/">Feature store</a></td>
    </tr>
    <tr>
        <td><a href="https://madewithml.com/courses/mlops/evaluation/">Evaluation</a></td>
        <td><a href="https://madewithml.com/courses/mlops/testing/">Code</a></td>
        <td><a href="https://madewithml.com/courses/mlops/pipelines/">Pipelines</a></td>
    </tr>
    <tr>
        <td><a href="https://madewithml.com/courses/mlops/experiment-tracking/">Experiment tracking</a></td>
        <td><a href="https://madewithml.com/courses/mlops/testing/#data">Data</a></td>
        <td><a href="https://madewithml.com/courses/mlops/continual-learning/">Continual learning</a></td>
    </tr>
    <tr>
        <td><a href="https://madewithml.com/courses/mlops/optimization/">Optimization</a></td>
        <td><a href="https://madewithml.com/courses/mlops/testing/#models">Models</a></td>
        <td></td>
    </tr>
</table>

üìÜ&nbsp; New lessons every month!<br>
<a href="https://newsletter.madewithml.com" target="_blank">Subscribe</a> for our monthly updates on new content.

<br>

## Directory structure
```bash
app/
‚îú‚îÄ‚îÄ api.py        - FastAPI app
‚îî‚îÄ‚îÄ cli.py        - CLI app
‚îú‚îÄ‚îÄ schemas.py    - API model schemas
tagifai/
‚îú‚îÄ‚îÄ config.py     - configuration setup
‚îú‚îÄ‚îÄ data.py       - data processing components
‚îú‚îÄ‚îÄ eval.py       - evaluation components
‚îú‚îÄ‚îÄ main.py       - training/optimization pipelines
‚îú‚îÄ‚îÄ models.py     - model architectures
‚îú‚îÄ‚îÄ predict.py    - inference components
‚îú‚îÄ‚îÄ train.py      - training components
‚îî‚îÄ‚îÄ utils.py      - supplementary utilities
```
> Documentation for this application can be found [here](https://gokumohandas.github.io/mlops/).

## Workflows

1. Set up environment.
```bash
make venv
source venv/bin/activate
```

2. Get data
```bash
# Download to data/
tagifai download-data

# or Pull from DVC
dvc init
dvc remote add -d storage stores/blob
dvc pull
```

3. Compute features
```bash
tagifai compute-features
```

4. Optimize using distributions specified in `tagifai.main.objective`. This also writes the best model's params to [config/params.json](https://github.com/GokuMohandas/MLOps/blob/main/config/params.json)
```bash
tagifai optimize \
    --params-fp config/params.json \
    --study-name optimization \
    --num-trials 100
```
> You can use your own on-prem GPUs, infrastructure from cloud providers (AWS, GCP, Azure, etc.) or check out the [optimize.ipynb](https://colab.research.google.com/github/GokuMohandas/MLOps/blob/main/notebooks/optimize.ipynb) notebook for how to train on Google Colab and transfer trained artifacts to your local machine.

5. Train a model (and save all it's artifacts) using params from [config/params.json](https://github.com/GokuMohandas/MLOps/blob/main/config/params.json) and publish metrics to [model/performance.json](https://github.com/GokuMohandas/MLOps/blob/main/model/performance.json). You can view the entire run's details inside `experiments/{experiment_id}/{run_id}` or via the API (`GET` /runs/{run_id}).
```bash
tagifai train-model \
    --params-fp config/params.json \
    --model-dir model \
    --experiment-name best \
    --run-name model
```

6. Predict tags for an input sentence. It'll use the best model saved from `train-model` but you can also specify a `run-id` to choose a specific model.

    - Command-line app
        ```bash
        tagifai predict-tags --text "Transfer learning with BERT"
        ```

    - FastAPI
        ```bash
        uvicorn app.api:app \
            --host 0.0.0.0 \
            --port 5000 \
            --reload \
            --reload-dir tagifai \
            --reload-dir app
        ```

7. View improvements
Once you're done training the best model using the current data version, best hyperparameters, etc., we can view performance difference.
```bash
tagifai diff
```

8. Push versioned assets
```
# Push
dvc add data/projects.json
dvc add data/tags.json
dvc add data/features.json
dvc add data/features.parquet
dvc push
```

9. Commit to git
This will clean and update versioned assets (data, experiments), run tests, styling, etc.
```bash
git add .
git commit -m ""
git tag -a <TAG_NAME> -m ""
git push origin <BRANCH_NAME>
```

## Commands

### Environments
```bash
python -m pip install -e . --no-cache-dir  # prod
python -m pip install -e ".[test]" --no-cache-dir  # test
python -m pip install -e ".[docs]" --no-cache-dir  # docs
python -m pip install -e ".[dev]" --no-cache-dir  # dev
pre-commit install
pre-commit autoupdate
```

### Docker
```bash
docker build -t tagifai:latest -f Dockerfile .
docker run -p 5000:5000 --name tagifai tagifai:latest
```

### Application
```bash
uvicorn app.api:app --host 0.0.0.0 --port 5000 --reload --reload-dir tagifai --reload-dir app  # dev
gunicorn -c config/gunicorn.py -k uvicorn.workers.UvicornWorker app.api:app  # prod
```

### Streamlit
```bash
streamlit run streamlit/app.py
```

### MLFlow
```bash
mlflow server -h 0.0.0.0 -p 5000 --backend-store-uri stores/model/
```

### Airflow
1. Set up
```bash
AIRFLOW_VERSION=2.0.1
PYTHON_VERSION="$(python --version | cut -d " " -f 2 | cut -d "." -f 1-2)"
CONSTRAINT_URL="https://raw.githubusercontent.com/apache/airflow/constraints-${AIRFLOW_VERSION}/constraints-${PYTHON_VERSION}.txt"
pip install "apache-airflow==${AIRFLOW_VERSION}" --constraint "${CONSTRAINT_URL}"
airflow db init  # `airflow db reset` to reset everything
airflow users create \
    --username admin \
    --firstname Goku \
    --lastname Mohandas \
    --role Admin \
    --email hello@madewithml.com
```

2. Run webserver
```bash
export AIRFLOW_HOME=${PWD}/airflow
airflow webserver --port 8080
```

Run scheduler (in separate terminal)
```bash
export AIRFLOW_HOME=${PWD}/airflow
airflow scheduler
```

### Feature store
```bash
feast init --minimal --template local features
touch features/features.py
cd features
feast apply
CURRENT_TIME=$(date -u +"%Y-%m-%dT%H:%M:%S")
feast materialize-incremental $CURRENT_TIME
```

### Mkdocs
```bash
python -m mkdocs serve
```

### Testing
- Great expectation checkpoints (read more [here](https://madewithml.com/courses/mlops/testing/#data))
    ```bash
    great_expectations checkpoint run projects
    great_expectations checkpoint run tags
    ```

- Full coverage testing
    ```bash
    pytest tests --cov tagifai --cov app  # report in STDOUT
    pytest tests --cov tagifai --cov app --cov-report html  # report in htmlcov/
    ```

- Testing only the non-training components
    ```bash
    pytest -m "not training"
    ```

### Jupyterlab
```bash
python -m ipykernel install --user --name=tagifai
jupyter labextension install @jupyter-widgets/jupyterlab-manager
jupyter labextension install @jupyterlab/toc
jupyter lab
```
> You can also run all notebooks on [Google Colab](https://colab.research.google.com/github/GokuMohandas/MLOps/blob/main/notebooks/tagifai.ipynb).

## FAQ

### Who is this content for?
- `Software engineers` looking to learn ML and become even better software engineers.
- `Data scientists` who want to learn how to responsibly deliver value with ML.
- `College graduates` looking to learn the practical skills they'll need for the industry.
- `Product Managers` who want to develop a technical foundation for ML applications.

### What is the structure?
Lessons will be released weekly and each one will include:
- `intuition`: high level overview of the concepts that will be covered and how it all fits together.
- `code`: simple code examples to illustrate the concept.
- `application`: applying the concept to our specific task.
- `extensions`: brief look at other tools and techniques that will be useful for difference situations.

### What makes this content unique?
- `hands-on`: If you search production ML or MLOps online, you'll find great blog posts and tweets. But in order to really understand these concepts, you need to implement them. Unfortunately, you don‚Äôt see a lot of the inner workings of running production ML because of scale, proprietary content & expensive tools. However, Made With ML is free, open and live which makes it a perfect learning opportunity for the community.
- `intuition-first`: We will never jump straight to code. In every lesson, we will develop intuition for the concepts and think about it from a product perspective.
- `software engineering`: This course isn't just about ML. In fact, it's mostly about clean software engineering! We'll cover important concepts like versioning, testing, logging, etc. that really makes something production-grade product.
- `focused yet holistic`: For every concept, we'll not only cover what's most important for our specific task (this is the case study aspect) but we'll also cover related methods (this is the guide aspect) which may prove to be useful in other situations.

### Who is the author?
- I've deployed large scale ML systems at Apple as well as smaller systems with constraints at startups and want to share the common principles I've learned.
- Connect with me on <a href="https://twitter.com/GokuMohandas" target="_blank"><i class="fab fa-twitter ai-color-info mr-1"></i>Twitter</a> and <a href="https://www.linkedin.com/in/goku" target="_blank"><i class="fab fa-linkedin ai-color-primary mr-1"></i>LinkedIn</a>

### Why is this free?
While this content is for everyone, it's especially targeted towards people who don't have as much opportunity to learn. I believe that creativity and intelligence are randomly distributed while opportunities are siloed. I want to enable more people to create and contribute to innovation.

<!-- Citation -->
<hr>
To cite this course, please use:

```bibtex
@misc{madewithml,
    author       = {Goku Mohandas},
    title        = {Made With ML MLOps Course},
    howpublished = {\url{https://madewithml.com/}},
    year         = {2021}
}
```
